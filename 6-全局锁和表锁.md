# 6-全局锁和表锁

根据加锁的范围，Mysql里面的锁，大致可以分为全局锁、表级锁和行锁。

### 全局锁
1. MYSQL提供了加全局读锁的方法，命令是Flush tables with read lock（FTWRL）。
执行该命令后，以下语句会被阻塞：
	* 数据更新语句（数据的增删改）
	* 数据定义语句（create/alter）
	* 更新类事务的提交语句。	
2. 全局锁的典型使用场景是，做全库的逻辑备份。不加锁备份的话，备份的数据不是一个逻辑时间点，这个视图的逻辑是不一致的。
3. 如果想得到一个一致性视图，也可以再《可重复读级别》下开启一个事务。
	MYSQL自带的逻辑备份工具mysqldump，当mysqldump使用参数-single-transaction的时候、导数据之前就会启动一个事务，来确保拿到一致性视图。【需要引擎支持可重复读这个隔离级别】
4. 想全库只读，为什么不使用set global readonly=true
    * 再有些系统中，readonly的值会被用来判断主库还是从库。
    * 如果执行FTWRL命令之后由于客户端发生异常断开，那么MYSQL会自动释放这个全局锁，整个库可以回到正常状态。而readonly则会一致保持readonly状态
    
### 表锁	
1. MYSQL表级锁有两种，表锁、元数据锁meta data lock，MDL
    * 表锁lock table...with read/write，可以使用unlock主动释放锁，也可以在客户端断开的时候自动释放。
	lock table除了会限制别的线程的读写外，也限定了本线程接下来的操作对象。
	innodb这样的引擎一般不使用表锁，影响面太大。
	
    * MDL不需要显示使用，在访问一个表的时候会被自动加上。
	当对一张表进行增删改查的时候会加读锁，当要变更表结构的时候会加写锁。
	读锁之间不互斥
	读写锁之间，写锁之间是互斥的。

### 如何安全的给小表增加字段
alter table tbl_name wait n add coluimn...
	



