# 字符串字段索引


### 一、前缀索引
alter table t add index idx_email1(email)，索引包含了整个email字符串
alter table t add index idx_email2(email(6))，索引包含了email字段的前6位字符串

优势：占用空间小
损失：可能会增加额外的扫描次数

使用前缀索引，定义好长度，就可以做到既节省空间，又不用额外增加太多的查询成本。

如何能确定应该使用多长的前缀索引？
区分度
select count(distinct(email)) as a1 from t;
select count(distinct left(email,n)) as a2 from t;
a2越接近a1越好。


覆盖索引：
select id，email from t where...
这个时候，返回的数据只有id和email，则可以利用覆盖索引，直接返回，不需要回表查询。

注意：使用前缀索引，则不得不再回表查询，判断email的值。


### 倒序存储+前缀索引、hash字段
身份证，前几位区分度不好，可以使用
1. 倒序存储+前缀索引
2. hash字段

以上相同点：都不支持范围查询，只能支持等值查询
区别：
（1）hash会增加一个字段，进而会消耗额外的存储空间
（2）都需要调用函数，但是reverse()函数额外消耗的CPU资源比crc32()会更小一些
（3）由于倒序索引最终还是使用前缀索引，可能会增加扫描次数；但是hash字段方式使用crc32()算出来的值冲突的概率非常小，可以认为每次查询的平均扫描行数接近1.



## 总结：
* 直接创建索引，会比较占用空间
* 创建前缀索引，节省空间，但是可能会增加扫描次数，且不能使用覆盖索引
* 倒序存储+前缀索引，解决字段前部分区分度低，后部分区分度高的问题，不支持范围查询
* 创建hash字段索引，查询性能稳定，有额外的存储和计算消耗，不支持范围查询



